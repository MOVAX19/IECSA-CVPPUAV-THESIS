\chapter{Introducción}

\section{Antecedente históricos}
En diciembre de 1903, Orville Wright realizó el primer vuelo tripulado en la historia de la humanidad; no tuvo que pasar mucho tiempo para que el concepto de vehículo aéreo no tripulado tuviera un auge dentro de la comunidad científica y militar enfocada a la aviación.

Siendo estrictamente correctos, si se toma en consideración los vehículos capaces de generar sustentación y/o que cuentan con un medio para su control, se puede decir que el primer UAV de la historia, fue diseñado por el inglés Douglas Archibald, al fijar un anemómetro en la cuerda de un cometa, con lo cual fue capaz de medir  la velocidad del viento a una altura de aproximadamente 1200 ft. Más tarde, en 1887, Archibald colocó cámaras en otra cometa, con lo cual desarrolló el primer UAV de reconocimiento, en el mundo.

Hablando específicamente de quadrotores, en 1907, Louis Breguet, un pionero francés de la aviación, junto con su hermano Jacques y su profesor Charles Richet, hicieron una demostración del diseño de un giroplano de 4 rotores. Este prototipo contaba con un motor de 30 caballos de fuerza que alimentaba los 4 rotores, cada uno de los cuales tenía 4 propelas y lograba elevarse hasta un máximo de 0.6 m.

Por otro lado, Etienne Oehmichen, un ingeniero francés, fue el primero en experimentar con diseños de aeronaves de ala rotativa. En 1920, construyó y probó 6 diseños, el segundo de ellos tenía 4 motores y 8 propelas; el cuerpo de esta aeronave estaba hecho de tubos de acero y tenía 4 extremidades, en las cuales se alojaban cada uno de sus rotores con 2 propelas cada uno. En su momento, este diseño destacaba en su estabilidad y controlabilidad, y para la mitad de 1920 ya había realizado más de mil vuelos de prueba. En 1924 estableció un récord mundial al volar una distancia horizontal de 360 m.

Después, en 1922 el Dr. George de Bothezt e Iván Jerome desarrollaron una aeronave con una estructura en forma de equis y rotores de 6 propelas en sus extremidades. Para 1923 habían realizado hasta 100 vuelos de prueba con una altura máxima de 5 m; sin embargo, este diseño era muy complejo y rígido, dificultando su movimiento lateral y suponiendo una  carga de trabajo, para alimentar la maquinaria, demasiado alta para el piloto.

Además, en 1956 se desarrolló el Convertawings Model A, el cual fue pensado para formar parte de una línea de quadrotores grandes para uso civil y militar. Este prototipo contaba con dos motores, que controlan el giro de dos rotores, cada uno, a partir de lo anterior, el control de la aeronave se lograba al variar el empuje proporcionado por los rotores.


%\section{Motivación}



\section{Objetivos}
\subsection{Objetivo general}

Implementar en simulación un algoritmo de detección de compuertas rectangulares mediante visión artificial junto con una metodología para el seguimiento de trayectoria de vuelo en un cuadricóptero autónomo virtual.

\subsection{Objetivo específicos}

\begin{itemize}
    \item Diseñar un algoritmo de visión artificial capaz de identificar compuertas rectangulares 
    \item Diseñar un algoritmo de gestión de trayectorias de vuelo para un cuadricóptero autónomo 
    \item Diseñar un ambiente de simulación en 3D de un circuito de vuelo basado en una carrera de cuadricópteros autónomos. 
    \item Implementar un ambiente de Software in The Loop utilizando los algoritmos y el ambiente de simulación diseñados para verificar su comportamiento en conjunto 
\end{itemize}

\section{Justificación}
Lejos de ser un atractivo visual y un espectáculo con fines de entretenimiento, las competencias de drones autónomos representan el estado del arte de la robótica aplicada a vehículos con sistemas de navegación autónoma.
Lo anterior se debe a que la robótica siempre se ha enfocado a la automatización de los sistemas; es decir, que los robots sean capaces de realizar tareas o recorridos sin necesidad de intervención humana, para esta última parte, se necesita de algoritmos de percepción y navegación, con los cuales los vehículos puedan ubicarse en el espacio a partir de su sistema de sensores con el que cuentan (tales como tecnología a base de láseres, cámaras estereoscópicas, tecnología ultrasónica, etc.) para que después sea capaz de trazar una trayectoria o seguir una ruta previamente definida.   

Esta tecnología ha adquirido una robustez bastante significativa en los últimos años, pues existe una gran cantidad de esfuerzos y colaboraciones dedicadas al desarrollo de los mismos, incluso, se han organizado eventos y competencias con el fin de estimular y potenciar el desarrollo de este tipo de sistemas; tal es el caso de la International Conference on Intelligent Robots and systems (IROS) y AlphaPilot, dos eventos de gran magnitud, creados con el objetivo de tratar, demostrar y fomentar los avances que se tienen en el área.

Por otro lado, la implementación de un sistema robótico autónomo no es una tarea sencilla, y debido a la poca competencia en el mercado también adquiere un costo elevado. 
Para que un robot sea capaz de percibir el ambiente a su alrededor y desplazarse por el mismo, es necesario implementar un sistema de software capaz de coordinar la adquisición de datos proveídos por los sensores y el conjunto de actuadores que permiten que el sistema se desplace. Muchas de las soluciones desarrolladas para afrontar este desafío son privadas y no sé comparte con el público en general, además, algoritmos como el filtro de Kalman o un control PID son ampliamente utilizados en este tipo de sistemas, por lo que existe una posibilidad bastante alta de que todas estas soluciones implementen los mismos algoritmos, lo cual conlleva un desperdicio de tiempo y esfuerzo, sin mencionar que la calidad y eficiencia de cada implementación puede variar bastante.
Debido a lo anterior, soluciones de código abierto como ROS (Robot Operating System; un framework de comunicaciones para el manejo y coordinación de procesos en sistemas robóticos), pueden representar el inicio de la implementación de un estándar en el área, pues al ser de software libre permiten que toda la comunidad utilice, mejore e inspeccione los algoritmos ya implementados.

Además, la realización de pruebas con el sistema físico, para verificar y validar los algoritmos desarrollados, representa un costo muy alto en la mayoría de sistemas con los que se trabaja en el área, por lo que también es necesario disponer de algún tipo de simulador que permita realizar las pruebas sin necesidad de utilizar el prototipo físico con el que se trabajará. Existen diferentes paradigmas de simulación en los que se puede simular la planta mediante software, tales como Hardware in the loop (HIL) y software in the loop (SIL). Ambos paradigmas representan una solución al problema planteado, proveyendo resultados muy cercanos a la realidad y con una arquitectura flexible, que permite realizar una gran cantidad de pruebas o incluso entrenar algoritmos relacionados con inteligencia artificial o redes neuronales, una vez más, sin depender del sistema físico. 

A partir de todo lo anterior, en este trabajo se propone el diseño y la simulación de un algoritmo de visión por computadora para la detección de compuertas rectangulares, similares a aquellas utilizadas en las competencias de drones autónomos, mismas que se utilizan para trazar un circuito de vuelo, para el cual se define un algoritmo de seguimiento de trayectoria para que un dron virtual autónomo sea capaz de completar el circuito definido.  El desarrollo e implementación de los algoritmos se realiza dentro de un framework de simulación de SIL, y la gestión y comunicación entre procesos se implementan a partir de una arquitectura diseñada en ROS2, todo lo anterior bajo el paradigma de código abierto, con el fin de aprovechar las ventajas previamente mencionadas y aportar los esquemas de configuración y diseño a la comunidad.


\section{Planteamiento del problema}
Los sistemas aéreos de navegación autónomos han tenido un hito importante en los últimos años, a tal grado que, al día de hoy, existen propuestas bastante sofisticadas de sistemas para la creación de rutas para misiones de vuelo basadas en la detección de guías visuales utilizando visión artificial. Sin embargo, previo a la implementación de cualquier de propuesta, siempre existe una fase de pruebas en donde sé válida el desempeño y comportamiento de la propuesta definida, para realizar lo anterior, es necesario disponer de herramientas de simulación que, valga la redundancia, permitan simular con la mayor fidelidad posible a la realidad el sistema que se desea implementar. De tal manera que si es necesario realizar algún tipo de cambio a la propuesta de solución, se realice antes de implementarla en un sistema físico, ahorrado sustento económico y acelerando el desarrollo del proyecto; esto último corresponde a algunas de las ventajas de las simulaciones tipo SIL. 

En este trabajo se propone la integración de diversas herramientas de última generación con bajos requerimientos de hardware, instalación multiplataforma y de código abierto para la creación de un ambiente de simulación en 3D con físicas realistas, integrando un modelo de dron comercial y en donde sea posible implementar algoritmos de visión artificial y de seguimiento de trayectoria, de tal forma que puedan interactuar con un controlador de vuelo simulado y guiar al dron a través de un circuito de vuelo.    

En todo su conjunto, lo anterior representa las bases de un framework de SIL para validar todo tipo de algoritmos asociados al vuelo autónomo de un dron.

\section{Contribuciones}

Este trabajo cuenta con 3 principales aportaciones al campo de estudio:

\begin{itemize}
    \item El diseño y la implementación de un ambiente de simulación basado en ROS 2, para la validación de algoritmos de detección y navegación enfocados en misiones de vuelo de drones autónomos
    \item La documentación detallada del proceso seguido para la creación del ambiente de simulación también representa una contribución importante, pues debido a que ROS 2 es una tecnología emergente, no existe mucha documentación relacionada con implementaciones de este tipo para el campo de estudio en cuestión.
    \item Por último, debido a la naturaleza de las tecnologías utilizadas para el proyecto, el código fuente, en conjunto con las instrucciones de creación y utilización del framework, se comparten bajo el paradigma de código abierto, con el objetivo de beneficiar a la comunidad y usuarios de ROS, así como formar parte de la descentralización del conocimiento.
\end{itemize}


\section{Metodología}

En primera instancia, se realiza una revisión bibliográfica intensiva acerca del estado del arte en cuanto a drones guiados por visión artificial, con el objetivo de visualizar las soluciones ya implementadas y conceptualizar la arquitectura necesaria para el sistema, sus componentes, los algoritmos de visión artificial y sistemas de gestión de trayectoria empleados, así como la configuración necesaria para realizar la integración de todo lo anterior.

Posteriormente, se define el esquema general del proyecto estableciendo el algoritmo de visión artificial a utilizar, la metodología para el seguimiento de la misión de vuelo, el ambiente de simulación, la interfaz de comunicación para la adquisición de datos e imágenes provenientes de la simulación, el modelo de dron a simular y las librerías necesarias para integrar el ambiente de simulación.

Establecido lo anterior, se implementa la arquitectura diseñada para el ambiente de simulación y se realizan vuelos cortos enviando comandos de vuelo básicos al controlador de vuelo simulado, con el objetivo de observar el comportamiento del modelo de dron ante esta serie de comandos, dentro del circuito de vuelo definido. A partir de lo anterior, se extraen imágenes de la trayectoria de vuelo del dron por medio de una cámara simulada a bordo del modelo del dron y se registran los datos obtenidos a partir de los sensores simulados dentro del entorno virtual; se utilizan las imágenes recopiladas y los datos recopilados para el desarrollo de los algoritmos propuestos, en conjunto con el análisis de su desempeño.

Cuando el algoritmo de visión artificial proporciona una identificación adecuada del tipo de compuerta utilizada y el algoritmo de seguimiento de trayectoria permite que el dron complete una misión de vuelo de prueba, se implementan los algoritmos con base en la arquitectura definida. Se realiza la validación del algoritmo dentro del mismo circuito de vuelo. 

A lo largo de la ejecución de la simulación, existe un intercambio de información constante entre el dron virtual y los algoritmos implementados, la simulación envía imágenes obtenidas durante el vuelo del dron y el algoritmo de visión artificial las analiza, de tal forma que es capaz de identificar y aislar las compuertas dentro del fotograma, si es que existe alguna dentro del campo de visión y a la suficiente distancia como para ser detectada; por otro lado, el gestor de trayectoria se encuentra realizando la lectura de los sensores y el estado del piloto automático, con el fin de guiar el vuelo del dron con base en la misión de vuelo establecida, indicando el waypoint pertinente según la ubicación del dron durante su vuelo. En pocas palabras, al final de este trabajo, el dron es capaz de completar el circuito de vuelo y detectar las compuertas que lo delimitan a lo largo de su recorrido.

Por último, se reportan los resultados obtenidos y los problemas enfrentados a lo largo de cada una de las etapas de desarrollo del proyecto, así como las posibles mejoras a futuro para el proyecto en su conjunto.



\section{Límites y alcances}

\subsection{Alcances}
Se implementa un algoritmo de visión por computadora a partir de la detección del color de las compuertas que conforman un circuito de vuelo dentro de un ambiente de simulación personalizado; se realiza la conversión del espacio de color del fotograma captado por la cámara de un dron simulado al modelo de color HSV, y después de un proceso de calibración del rango de color, se utilizan métodos de apertura y cerradura para aislar el objeto de interés para su detección. Por otro lado, se utiliza la librería PymavLink para entablar comunicación con un piloto automático simulado, de tal forma que a partir de una serie de scripts se indican comandos de vuelo que sirven para definir la trayectoria de vuelo de un dron virtual. A partir de lo anterior, se define una arquitectura que integra ambas propuestas.  

La arquitectura es evaluada dentro de un entorno de simulación realizado en simulador Gazebo 11, en donde se virtualiza un circuito o pista de obstáculos compuesta por compuertas rectangulares de distintas alturas y color sólido, colocadas en distintas posiciones y orientaciones a lo largo del circuito. Se utiliza ROS2 para coordinar el envío de datos entre la simulación de Gazebo 11 y un nodo independiente de ROS2 para cada algoritmo. Además, se documenta de forma detallada la configuración realizada para la creación del ambiente de simulación, especificando la integración entre Gazebo, ROS, ArduPilot, OpenCV y Pymavlink. Por último, el proyecto en su conjunto se distribuye bajo el paradigma de código abierto.

\subsection{Límites}
A diferencia de las contribuciones y proyectos más populares dentro de la comunidad de las carreras de drones autónomos, en donde se utiliza ROS 1 y Gazebo en su versión 9, en este proyecto se implementa la última versión estable de ROS2, Foxy, y la versión más actual del simulador Gazebo, que al momento de escritura del trabajo es la versión 11. Entonces, algunos plugins tanto de ROS como de Gazebo, que facilitan la interacción entre ambos y la implementación de otras metodologías más sofisticadas, no se encuentren disponibles en estas versiones, lo que significa una limitante para la expansión a futuro del proyecto. 

Por otro lado, dentro del ambiente de simulación, no se evalúan condiciones de vuelo poco ventajosas como viento en contra, lluvia o cualquier otra condición climática adversa. Además, la complejidad en el arreglo de compuertas para el circuito es baja, de tal forma que se conoce la composición exacta del circuito previo al vuelo del dron y se utiliza la ubicación ya conocida de las compuertas para la definición de la misión de vuelo; adicionalmente, las compuertas se encuentran siempre de forma perpendicular a la vista de la cámara del dron y se utiliza un solo modelo de dron y tipo de compuerta a lo largo del desarrollo de todo el proyecto.


\section{Estructura de la tesis}
El presente trabajo se divide en 5 grandes partes; la introducción relata el contexto histórico que sirvió como base para llegar al estado del arte que se tiene hoy en día, además, dentro de este mismo capítulo se establecen los objetivos y se clarifican todas aquellas partes que le dan sustento a la motivación detrás de la creación del proyecto, tales como la justificación, metodología, etc.; la segunda parte corresponde al estado del arte del enfoque tecnológico abarcado, en él se dan ejemplos específicos y prácticos de aplicaciones contemporáneas en donde se hace uso de las tecnologías e implementaciones más sofisticadas y avanzadas que se tienen hasta el momento dentro del campo de aplicación; la parte del marco teórico tiene por objetivo fundamentar y detallar de la forma más explicita posible la implementación desarrollada para el proyecto, desglosando el funcionamiento base de los algoritmos utilizando así como dando un panorama general del acercamiento que se siguió para solucionar el problema planteado, además, brinda una descripcción bastante detallada de las tecnologías utilizadas así como sus ventajas, desventajas y prestigio actual; adicionalmente, dentro de apartado de resultado se encuentra descrito a gran detalle el procedimiento desarrollado para la implementación del proyecto, así como el comportamiento, los resultados y los problemas enfrentados en cada uno de las partes, esta sección representa la culminación de la aportación del proyecto y funciona como guía para entender con mayor detalle el contexto bajo el cual se trabajó, así como el progreso gradual observado durante la elaboración del proyecto.

Por último, haciendo la función de cierre, se incluye un capítulo dedicado a la conclusión del trabajo, en donde se realiza una recapitulación del trabajo realizado de tal manera que se completa con los resultados observados y se da una retroalimentación objetiva mencionando las posibles mejoras para continuar el trabajo en un futuro o utilizar las bases de este para la creación de otros proyectos.

Dicho lo anterior, se da por finalizada la primera parte del trabajo, dando preámbulo a la siguiente, el estado del arte.